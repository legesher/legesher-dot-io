---
import { Button } from "@/components/ui/button";
---

<section class="py-24 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="max-w-2xl mx-auto text-center">
      <div class="relative">
        <div class="absolute inset-0 flex items-center justify-center">
          <div class="w-64 h-64 rounded-full bg-brand-yellow/10 blur-2xl"></div>
        </div>
        <img 
          src="/EggPeggyGrey.38a3d5dc.png" 
          alt="Hatching egg" 
          class="mx-auto mb-8 w-40 md:w-48 lg:w-56 relative animate-float" 
        />
      </div>
      <h2 class="text-3xl md:text-4xl font-bold mb-4">Stay In The Know</h2>
      <p class="text-lg text-muted-foreground mb-8">
        Legesher will be hatching beta soon. Subscribe to our newsletter for updates on when Legesher will be welcomed into this world - and how you can help!
      </p>
      <form id="newsletter-form" class="flex flex-col gap-4 max-w-md mx-auto">
        <div class="flex flex-col sm:flex-row gap-4">
          <input
            type="text"
            name="firstName"
            placeholder="First Name"
            class="flex-1 px-4 py-2 rounded-lg border-2 border-gray-200 bg-white shadow-[0_2px_4px_rgba(0,0,0,0.05)] hover:border-brand-yellow focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/20 focus:outline-none transition-all duration-200"
            required
          />
          <input
            type="email"
            name="email"
            placeholder="Enter your best email"
            class="flex-1 px-4 py-2 rounded-lg border-2 border-gray-200 bg-white shadow-[0_2px_4px_rgba(0,0,0,0.05)] hover:border-brand-yellow focus:border-brand-yellow focus:ring-2 focus:ring-brand-yellow/20 focus:outline-none transition-all duration-200"
            required
          />
        </div>
        <Button 
          type="submit" 
          className="yellow-button"
        >
          Subscribe
        </Button>
      </form>
      <p id="form-message" class="text-sm text-muted-foreground mt-4">
        We greatly respect your privacy. Unsubscribe at any time.
      </p>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('newsletter-form');
  const messageElement = document.getElementById('form-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target as HTMLFormElement);
    const email = formData.get('email');
    const firstName = formData.get('firstName');

    try {
      console.log('Submitting form data:', { email, firstName });
      
      const response = await fetch('/api/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email, firstName }),
      });

      const data = await response.json();
      console.log('Response data:', data);

      if (response.ok) {
        messageElement!.textContent = data.message || 'Successfully subscribed!';
        messageElement!.className = 'text-sm text-green-600 mt-4';
        (e.target as HTMLFormElement).reset();
      } else {
        const errorMessage = data.message || data.detail || 'Failed to subscribe. Please try again.';
        messageElement!.textContent = errorMessage;
        messageElement!.className = 'text-sm text-red-600 mt-4';
      }
    } catch (error) {
      console.error('Subscription error:', error);
      messageElement!.textContent = 'An error occurred. Please try again.';
      messageElement!.className = 'text-sm text-red-600 mt-4';
    }
  });
</script>

<style>
  section {
    background: linear-gradient(to bottom, hsl(var(--background)), hsl(var(--background)/0.8));
  }

  @keyframes float {
    0% {
      transform: translateY(0px) rotate(0deg);
    }
    25% {
      transform: translateY(-2px) rotate(1deg);
    }
    50% {
      transform: translateY(0px) rotate(-1deg);
    }
    75% {
      transform: translateY(-1px) rotate(0.5deg);
    }
    85% {
      transform: translateY(-3px) rotate(-0.5deg);
    }
    100% {
      transform: translateY(0px) rotate(0deg);
    }
  }

  .animate-float {
    animation: float 4s ease-in-out infinite;
    transform-origin: center bottom;
  }
</style> 