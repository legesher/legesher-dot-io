# Welcome first-time contributors
# Replaces behaviorbot/new-issue-welcome, new-pr-welcome, first-pr-merge

name: Welcome Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened, closed]

permissions:
  issues: write
  pull-requests: write

jobs:
  welcome-issue:
    if: github.event_name == 'issues'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/first-interaction@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          issue-message: |
            Thanks for opening your first issue here!

            If you're reporting a bug, please make sure you include steps to reproduce it. We get a lot of issues on this repo, so please be patient and we will get back to you as soon as we can.

            To help make it easier for us to investigate your issue, please follow the [contributing guidelines](https://docs.legesher.io/the-official-things/contributing-guidelines).

  welcome-pr:
    if: github.event_name == 'pull_request_target' && github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/first-interaction@v1
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          pr-message: |
            Thanks for opening this pull request!

            We use [semantic commit messages](https://docs.legesher.io/the-official-things/contributing-guidelines#commit-message-guidelines) to streamline the release process. Before your pull request can be merged, you should **update your pull request title** to start with a semantic prefix.

            Examples of commit messages with semantic prefixes:
            - `fix: don't overwrite prevent_default if default wasn't prevented`
            - `feat: add app.isPackaged() method`
            - `docs: app.isDefaultProtocolClient is now available on Linux`

            Things that will help get your PR across the finish line:
            - Follow the coding style guidelines
            - Run `npm run build` locally to catch errors earlier
            - Include tests when adding/changing behavior
            - Include screenshots and animated GIFs whenever possible

            We get a lot of pull requests on this repo, so please be patient and we will get back to you as soon as we can.

  congratulate-merge:
    if: github.event_name == 'pull_request_target' && github.event.action == 'closed' && github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            // Check if this is their first merged PR
            const creator = context.payload.pull_request.user.login;
            const { data: prs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'closed',
              per_page: 100
            });

            const mergedPRs = prs.filter(pr =>
              pr.user.login === creator &&
              pr.merged_at !== null &&
              pr.number !== context.payload.pull_request.number
            );

            if (mergedPRs.length === 0) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: `### Congrats on merging your first pull request with Legesher!

            **THANK YOU THANK YOU THANK YOU**

            We'd love to celebrate you and your contribution to the community. We couldn't thank you enough for your contribution. We hope you continue sharing your gifts and knowledge with not just us, but with the world around you.

            Welcome to the Legesher community!`
              });
            }
